generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model alert {
  id        Int      @id @default(autoincrement())
  type      String
  message   String
  memberId  Int?
  staffId   Int?
  branchId  Int
  createdAt DateTime @default(now())
  branch    branch   @relation(fields: [branchId], references: [id], map: "Alert_branchId_fkey")
  member    member?  @relation(fields: [memberId], references: [id], map: "Alert_memberId_fkey")
  user      user?    @relation(fields: [staffId], references: [id], map: "Alert_staffId_fkey")

  @@index([branchId], map: "Alert_branchId_fkey")
  @@index([memberId], map: "Alert_memberId_fkey")
  @@index([staffId], map: "Alert_staffId_fkey")
}

model booking {
  id            Int           @id @default(autoincrement())
  memberId      Int
  scheduleId    Int
  member        member        @relation(fields: [memberId], references: [id], map: "Booking_memberId_fkey")
  classschedule classschedule @relation(fields: [scheduleId], references: [id], map: "Booking_scheduleId_fkey")

  @@index([memberId], map: "Booking_memberId_fkey")
  @@index([scheduleId], map: "Booking_scheduleId_fkey")
}

model branch {
  id               Int                @id @default(autoincrement())
  name             String
  phone            String?
  createdAt        DateTime           @default(now())
  address          String?
  status           branch_status      @default(ACTIVE)
  alert            alert[]
  classschedule    classschedule[]
  expense          expense[]
  member           member[]
  memberattendance memberattendance[]
  plan             plan[]
  product          product[]
  session          session[]
  staffattendance  staffattendance[]
  user             user[]
}



model Member {
  id             Int       @id @default(autoincrement())
  fullName       String
  email          String?   @unique
  phone          String
  gender         String?
  age            Int?
  address        String?
  joinDate       DateTime  @default(now())
  branchId       Int
  planId         Int?
  membershipFrom DateTime?
  membershipTo   DateTime?

  //new fields 
   dob            String?
  paymentMode    String?
  interestedIn   String?
  amountPaid     Int?

  branch Branch  @relation(fields: [branchId], references: [id])
  plan   Plan?   @relation(fields: [planId], references: [id])

   attendances MemberAttendance[]//add
   bookings     Booking[]  //add    
   payments  Payment[]//add
   alerts Alert[]//add
   dietPlanAssignments DietPlanAssignment[]   // ðŸ”¥ new
workoutPlanAssignments WorkoutPlanAssignment[]  // ðŸ”¥ new
notificationLog  NotificationLog[]//add 

}

model Plan {
  id          Int       @id @default(autoincrement())
  name        String
  category    String?   // optional category
  description String?   // new field
  status      String    @default("ACTIVE") // new field, default ACTIVE
  duration    String
  price       Float
  createdAt   DateTime  @default(now())
  members     Member[]
  payments    Payment[]
}



model MemberAttendance {
  id         Int       @id @default(autoincrement())
  memberId   Int
  branchId   Int
  checkIn    DateTime  @default(now())
  checkOut   DateTime?
  createdAt  DateTime  @default(now()) // âœ… added

  member     Member    @relation(fields: [memberId], references: [id])
  branch     Branch    @relation(fields: [branchId], references:Â [id])
}


model StaffAttendance {
  id         Int       @id @default(autoincrement())
  staffId    Int
  branchId   Int
  checkIn    DateTime  @default(now())
  checkOut   DateTime?

  staff      User      @relation(fields: [staffId], references: [id])
  branch     Branch    @relation(fields: [branchId], references: [id])
}

model ClassType {
  id        Int       @id @default(autoincrement())
  name      String
  createdAt DateTime  @default(now())
  schedules ClassSchedule[]
}

model ClassSchedule {
  id          Int       @id @default(autoincrement())
  branchId    Int
  classTypeId Int
  trainerId   Int
  date        DateTime
  
  startTime   String
  endTime     String
  capacity    Int
  booking     booking[]
  branch      branch    @relation(fields: [branchId], references: [id], map: "ClassSchedule_branchId_fkey")
  classtype   classtype @relation(fields: [classTypeId], references: [id], map: "ClassSchedule_classTypeId_fkey")
 user        user      @relation(fields: [trainerId], references: [id], map: "ClassSchedule_trainerId_fkey")
//  user        Staff     @relation(fields: [trainerId], references: [id], map: "ClassSchedule_trainerId_fkey")

  classType   ClassType   @relation(fields: [classTypeId], references: [id])
  trainer     User        @relation(fields: [trainerId], references: [id])
  branch      Branch      @relation(fields: [branchId], references: [id])
  bookings    Booking[]
   members     Json? 
     status      String     @default("Active")   // <-- added now
     day     String?    
}

model classtype {
  id            Int             @id @default(autoincrement())
  name          String
  createdAt     DateTime        @default(now())
  classschedule classschedule[]
}

model dietmeal {
  id         Int      @id @default(autoincrement())
  dietPlanId Int
  time       String
  food       String
  dietplan   dietplan @relation(fields: [dietPlanId], references: [id], map: "DietMeal_dietPlanId_fkey")

  @@index([dietPlanId], map: "DietMeal_dietPlanId_fkey")
}

model dietplan {
  id                 Int                  @id @default(autoincrement())
  title              String
  notes              String?
  createdBy          Int
  branchId           Int
  createdAt          DateTime             @default(now())
  dietmeal           dietmeal[]
  dietplanassignment dietplanassignment[]
}

model dietplanassignment {
  id         Int      @id @default(autoincrement())
  dietPlanId Int
  memberId   Int
  assignedAt DateTime @default(now())
  dietplan   dietplan @relation(fields: [dietPlanId], references: [id], map: "DietPlanAssignment_dietPlanId_fkey")
  member     member   @relation(fields: [memberId], references: [id], map: "DietPlanAssignment_memberId_fkey")

  @@index([dietPlanId], map: "DietPlanAssignment_dietPlanId_fkey")
  @@index([memberId], map: "DietPlanAssignment_memberId_fkey")
}

model expense {
  id        Int      @id @default(autoincrement())
  title     String
  category  String
  amount    Float
  date      DateTime @default(now())
  branchId  Int
  notes     String?
  createdAt DateTime @default(now())
  branch    branch   @relation(fields: [branchId], references: [id], map: "Expense_branchId_fkey")

  @@index([branchId], map: "Expense_branchId_fkey")
}

model member {
  id                    Int                     @id @default(autoincrement())
  fullName              String
  email                 String?                 @unique(map: "Member_email_key")
  phone                 String
  gender                String?
  age                   Int?
  address               String?
  joinDate              DateTime                @default(now())
  branchId              Int
  planId                Int?
  membershipFrom        DateTime?
  membershipTo          DateTime?
  amountPaid            Int?
  dob                   String?
  interestedIn          String?
  paymentMode           String?
  alert                 alert[]
  booking               booking[]
  dietplanassignment    dietplanassignment[]
  branch                branch                  @relation(fields: [branchId], references: [id], map: "Member_branchId_fkey")
  plan                  plan?                   @relation(fields: [planId], references: [id], map: "Member_planId_fkey")
  memberattendance      memberattendance[]
  notificationlog       notificationlog[]
  payment               payment[]
  workoutplanassignment workoutplanassignment[]

  @@index([branchId], map: "Member_branchId_fkey")
  @@index([planId], map: "Member_planId_fkey")
}

model memberattendance {
  id        Int       @id @default(autoincrement())
  memberId  Int
  branchId  Int
  checkIn   DateTime  @default(now())
  checkOut  DateTime?
  createdAt DateTime  @default(now())
  branch    branch    @relation(fields: [branchId], references: [id], map: "MemberAttendance_branchId_fkey")
  member    member    @relation(fields: [memberId], references: [id], map: "MemberAttendance_memberId_fkey")

  @@index([branchId], map: "MemberAttendance_branchId_fkey")
  @@index([memberId], map: "MemberAttendance_memberId_fkey")
}

model notificationlog {
  id        Int      @id @default(autoincrement())
  type      String
  to        String
  message   String
  status    String   @default("PENDING")
  createdAt DateTime @default(now())
  memberId  Int?
  member    member?  @relation(fields: [memberId], references: [id], map: "NotificationLog_memberId_fkey")

  @@index([memberId], map: "NotificationLog_memberId_fkey")
}

model payment {
  id          Int      @id @default(autoincrement())
  memberId    Int
  planId      Int
  amount      Float
  paymentDate DateTime @default(now())
  invoiceNo   String   @unique(map: "Payment_invoiceNo_key")
  gstAmount   Float?
  gstPercent  Float?
  member      member   @relation(fields: [memberId], references: [id], map: "Payment_memberId_fkey")
  plan        plan     @relation(fields: [planId], references: [id], onDelete: Cascade, map: "Payment_planId_fkey")

  @@index([memberId], map: "Payment_memberId_fkey")
  @@index([planId], map: "Payment_planId_fkey")
}

model plan {
  id           Int           @id @default(autoincrement())
  name         String
  duration     plan_duration
  price        Float
  createdAt    DateTime      @default(now())
  category     String?
  description  String?
  status       String        @default("ACTIVE")
  branchId     Int?
  sessions     Int           @default(0)
  validityDays Int           @default(0)
  member       member[]
  payment      payment[]
  branch       branch?       @relation(fields: [branchId], references: [id], map: "Plan_branchId_fkey")

  @@index([branchId], map: "Plan_branchId_fkey")
}

model product {
  id            Int             @id @default(autoincrement())
  name          String
  sku           String?         @unique(map: "Product_sku_key")
  category      String?
  sellingPrice  Float
  costPrice     Float?
  currentStock  Int             @default(0)
  branchId      Int
  isActive      Boolean         @default(true)
  createdAt     DateTime        @default(now())
  branch        branch          @relation(fields: [branchId], references: [id], map: "Product_branchId_fkey")
  stockmovement stockmovement[]

  @@index([branchId], map: "Product_branchId_fkey")
}

model purchase {
  id              Int      @id @default(autoincrement())
  selectedPlan    String
  companyName     String
  email           String
  billingDuration String
  startDate       DateTime
  purchaseDate    DateTime @default(now())
  status          String   @default("pending")
}

model role {
  id        Int      @id @default(autoincrement())
  name      String   @unique(map: "Role_name_key")
  createdAt DateTime @default(now())
  user      user[]
}

model staffattendance {
  id       Int       @id @default(autoincrement())
  staffId  Int
  branchId Int
  checkIn  DateTime  @default(now())
  checkOut DateTime?
  branch   branch    @relation(fields: [branchId], references: [id], map: "StaffAttendance_branchId_fkey")
  user     user      @relation(fields: [staffId], references: [id], map: "StaffAttendance_staffId_fkey")

  @@index([branchId], map: "StaffAttendance_branchId_fkey")
  @@index([staffId], map: "StaffAttendance_staffId_fkey")
}

model stockmovement {
  id        Int      @id @default(autoincrement())
  productId Int
  type      String
  quantity  Int
  note      String?
  createdAt DateTime @default(now())
  product   product  @relation(fields: [productId], references: [id], map: "StockMovement_productId_fkey")

  @@index([productId], map: "StockMovement_productId_fkey")
}

model user {
  id              Int               @id @default(autoincrement())
  fullName        String
  email           String            @unique(map: "User_email_key")
  password        String
  phone           String?
  roleId          Int
  branchId        Int?
  createdAt       DateTime          @default(now())
  address         String?
  description     String?
  duration        String?
  gymName         String?
  planName        String?
  price           String?
  status          String?
  alert           alert[]
  classschedule   classschedule[]
  staffattendance staffattendance[]
  memberPlans     memberplan[]      @relation("UserMemberPlans")
  session         session[]
  branch          branch?           @relation(fields: [branchId], references: [id], map: "User_branchId_fkey")
  role            role              @relation(fields: [roleId], references: [id], map: "User_roleId_fkey")
//  staff           Staff //m. staff
  staff            Staff?            @relation("UserStaff")


  @@index([branchId], map: "User_branchId_fkey")
  @@index([roleId], map: "User_roleId_fkey")
}


//m. staff
model Staff {
  id           Int      @id @default(autoincrement())
  userId       Int      @unique
  gender       String
  dateOfBirth  DateTime
  joinDate     DateTime
  exitDate     DateTime?
  profilePhoto String?
  status       String   @default("Active")
 user         user     @relation("UserStaff", fields: [userId], references: [id])
  //user        user @relation(fields: [userId], references:Â [id])
}

model workoutexercise {
  id            Int         @id @default(autoincrement())
  workoutPlanId Int
  name          String
  sets          Int?
  reps          Int?
  duration      String?
  workoutplan   workoutplan @relation(fields: [workoutPlanId], references: [id], map: "WorkoutExercise_workoutPlanId_fkey")

  @@index([workoutPlanId], map: "WorkoutExercise_workoutPlanId_fkey")
}

model workoutplan {
  id                    Int                     @id @default(autoincrement())
  title                 String
  notes                 String?
  createdBy             Int
  branchId              Int
  createdAt             DateTime                @default(now())
  workoutexercise       workoutexercise[]
  workoutplanassignment workoutplanassignment[]
}

model workoutplanassignment {
  id            Int         @id @default(autoincrement())
  workoutPlanId Int
  memberId      Int
  assignedAt    DateTime    @default(now())
  member        member      @relation(fields: [memberId], references: [id], map: "WorkoutPlanAssignment_memberId_fkey")
  workoutplan   workoutplan @relation(fields: [workoutPlanId], references: [id], map: "WorkoutPlanAssignment_workoutPlanId_fkey")

  @@index([memberId], map: "WorkoutPlanAssignment_memberId_fkey")
  @@index([workoutPlanId], map: "WorkoutPlanAssignment_workoutPlanId_fkey")
}

enum plan_duration {
  Monthly
  Yearly
}

model memberplan {
  id           Int      @id @default(autoincrement())
  name         String
  sessions     Int
  validityDays Int
  price        Float
  type         String   @default("GROUP")

  // âœ… NEW
  adminId      Int
  admin        user     @relation("UserMemberPlans", fields: [adminId], references: [id])

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}


model session {
  id          Int       @id @default(autoincrement())
  sessionName String
  trainerId   Int
  branchId    Int
  date        DateTime
  time        String     // e.g. "10:00 AM" or "18:30"
  duration    Int        // minutes ya hours â€“ aapka logic ke hisaab se
  description String?
  status      String     @default("Upcoming") // Upcoming | Completed | Cancelled

  // Relations
  trainer     user       @relation(fields: [trainerId], references: [id], map: "Session_trainerId_fkey")
  branch      branch     @relation(fields: [branchId], references: [id], map: "Session_branchId_fkey")

  createdAt   DateTime   @default(now())

  @@index([trainerId])
  @@index([branchId])
}



enum branch_status {
  ACTIVE
  INACTIVE
}



